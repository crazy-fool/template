var _CW="cloudui-window";$.extend({clouduiWindow:function(a,b){$("body").on("click",a,function(){var c=a.replace("#","");c=c.replace(".",""),$.clouduiCreateWindow(c,b)})},clouduiCreateWindow:function(a,b){if(void 0==b.url)return alert("请指定窗体指向的URL地址"),!1;var c;if(0==$("#"+_CW+"-"+a).length){var d,e;void 0==b.width?d=400:(d=b.width,d.indexOf("px")!=-1?d=parseInt(d.replace("px","")):d.indexOf("%")!=-1&&(d=_innerW()*(parseInt(d.replace("%",""))/100))),void 0==b.height?e=400:(e=b.height,e.indexOf("px")!=-1?e=parseInt(e.replace("px","")):e.indexOf("%")!=-1&&(e=_innerH()*(parseInt(e.replace("%",""))/100)));var f=void 0==b.title?"默认窗口":b.title,g='<div class="cloudui-window" id="'+_CW+"-"+a+'" style="width:'+d+"px;height:"+e+"px;margin-left:-"+d/2+"px; margin-top:-"+e/2+'px;">';g+='<div class="cloudui-window-title">',g+="<span>"+f+"</span>",g+="</div>",g+='<div class="cloudui-window-close"></div>';var h=e-42;void 0!=b.btn&&b.btn.length>0&&(h-=50);var i=void 0==b.scrolling?"auto":b.scrolling;if(g+='<div class="cloudui-window-box" style="height:'+h+'px;">',g+='<iframe src="'+b.url+'" width="'+d+'" height="'+h+'" frameborder="0" scrolling="'+i+'" width="100%" height="100%"></iframe>',g+="</div>",void 0!=b.btn&&b.btn.length>0){var j=void 0==b.btnPosition?"right":b.btnPosition;g+='<div class="cloudui-window-btnbar" style="text-align:'+j+';">',$.each(b.btn,function(a,b){g+='<button class="',a>0&&(g+="btn-light"),"取消"==b.txt&&(g+=" "+_CW+"-cancel"),g+='">',g+=b.txt+"</button>"}),g+="</div>"}if(void 0!=b.move&&b.move&&(g+='<div class="cloudui-window-move-shade"></div>'),g+="</div>",$("body").append(g),c=$("#"+_CW+"-"+a),c.find("."+_CW+"-close, ."+_CW+"-cancel").click(function(a){c.hide(),cloudui.shadeHide(),void 0!=b.closeCallback&&$.isFunction(b.closeCallback)&&b.closeCallback()}),void 0!=b.btn&&b.btn.length>0&&c.find("."+_CW+"-btnbar").children('button:not(".cloudui-window-cancel")').click(function(){var a=c.find("iframe").contents();1==a.find("form").length&&a.find("form").append('<button style="display:none;" id="__submit"></button>'),void 0!=b.btn[$(this).index()].action&&b.btn[$(this).index()].action({window:c,iframe:a,submit:function(){a.find("#__submit").trigger("click")},reload:function(){c.find("iframe").attr("src",c.find("iframe").attr("src"))},this:$(this),form:a.find("form").serialize(),validate:function(){return a.find("#__submit").trigger("click"),!(a.find("[data-validate-error]").length>0)}})}),void 0!=b.move&&b.move){var k=c.find("."+_CW+"-move-shade");c.find("."+_CW+"-title").mousedown(function(){_pageDisabled(),k.width(d).height(e).css({top:c.offset().top,left:c.offset().left}).show(),$(document).mousemove(function(a){var b=a.clientY-15;b<0&&(b=0),b>_innerH()-e&&(b=_innerH()-e-2),k.css("top",b);var c=a.clientX-d/2;c<0&&(c=0),c>_innerW()-d&&(c=_innerW()-d-2),k.css("left",c)})}),k.mouseup(function(){$(document).unbind("mousemove"),k.hide(),c.css({top:k.css("top"),left:k.css("left"),margin:0}),_pageEnabled()})}}else c=$("#"+_CW+"-"+a),void 0!=b.refresh&&b.refresh&&c.find("iframe").attr("src",b.url);c.show(),cloudui.shadeShow()}});